var e=this&&this.__rest||function(e,t){var a={};for(var n in e){Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n])}if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++){t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}}return a};import t from"react";import{Alignment as a,Button as n,NumericInput as l,Slider as r,Switch as o}from"@blueprintjs/core";import{observer as i}from"mobx-react-lite";import{INDEPENDENT_FILTERS as d}from"../model/shape-model.js";import s from"../toolbar/color-picker.js";import{t as c}from"../utils/l10n.js";import{Cross as u}from"@blueprintjs/icons";import{EffectCard as m}from"./effect-card.js";import{Effects as b}from"../utils/filters.js";const h=(e,t,a)=>Math.max(t,Math.min(a,e));export const NumberInput=a=>{var{value:n,onValueChange:r}=a,o=e(a,["value","onValueChange"]);const[i,d]=t.useState(n.toString());return t.useEffect(()=>{d(n.toString())},[n]),t.createElement(l,Object.assign({value:i,onValueChange:(e,t)=>{d(t),Number.isNaN(e)||r(e)}},o))};const p=({label:e,enabled:n,visible:i=!0,onEnabledChange:d,numberValue:s,onNumberValueChange:c,min:u,max:m})=>i?t.createElement(t.Fragment,null,t.createElement(o,{checked:n,label:e,onChange:e=>{d(e.target.checked)},alignIndicator:a.RIGHT,style:{marginTop:"20px"}}),n&&t.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},t.createElement("div",{style:{paddingTop:"7px",paddingLeft:"10px",width:"calc(100% - 80px)"}},t.createElement(r,{value:s,onChange:e=>{c(e)},min:u,max:m,labelStepSize:50,showTrackFill:!1,labelRenderer:!1})),t.createElement(l,{value:s,onValueChange:e=>{c(h(e,u,m))},buttonPosition:"none",style:{width:"50px",padding:"0 5px",marginLeft:"10px"},min:u,max:m}))):null;export const EffectsPanel=i(({store:e})=>{var i,g,E,f,v,x,y,C,w,k,V,O,j,I;const M=e.selectedElements,R=M[0],T=()=>e.selectedElements.map(e=>e.id).join(","),S=t.useMemo(T,[]),N=T();if(t.useEffect(()=>{S!==N&&e.openSidePanel(e.previousOpenedSidePanel)},[S,N]),!R||!R.filters){return null}const P=(e=>"text"===e.type)(R),B=(e=>"image"===e.type)(R),z=(e=>"svg"===e.type)(R),F=B||z,H=t=>{e.history.transaction(()=>{M.forEach(e=>{e.set(t)})})},W=(t,a)=>{e.history.transaction(()=>{M.forEach(e=>{let n=+a;return 0==a||a||(n=e.filters.has(t)?null:1),d.includes(t)||e.set({grayscaleEnabled:"grayscale"===t&&a,sepiaEnabled:"sepia"===t&&a}),e.setFilter(t,n)})})};return t.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"auto",padding:"0 10px"}},t.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},t.createElement("h3",{style:{margin:0,lineHeight:"30px"}},c("sidePanel.effects")),t.createElement(n,{minimal:!0,icon:t.createElement(u,null),onClick:()=>e.openSidePanel(e.previousOpenedSidePanel)})),F&&t.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginTop:"16px"}},t.createElement("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap"}},t.createElement(m,{active:R.grayscaleEnabled,onClick:()=>{W("grayscale",!R.grayscaleEnabled)},title:c("toolbar.grayscale"),imageSrc:R.src,effect:b.grayscale}),t.createElement(m,{active:R.sepiaEnabled,onClick:()=>{W("sepia",!R.sepiaEnabled)},title:c("toolbar.sepia"),imageSrc:R.src,effect:b.sepia}),t.createElement(m,{active:R.filters.has("cold"),onClick:()=>{W("cold",R.filters.has("cold")?null:1)},title:c("toolbar.cold"),imageSrc:R.src,effect:b.cold}),t.createElement(m,{active:R.filters.has("natural"),onClick:()=>{W("natural",R.filters.has("natural")?null:1)},title:c("toolbar.natural"),imageSrc:R.src,effect:b.natural}),t.createElement(m,{active:R.filters.has("warm"),onClick:()=>{W("warm",R.filters.has("warm")?null:1)},title:c("toolbar.warm"),imageSrc:R.src,effect:b.warm}))),t.createElement(p,{label:c("toolbar.blur"),enabled:R.blurEnabled,visible:F||P,onEnabledChange:e=>{H({blurEnabled:e})},numberValue:R.blurRadius,onNumberValueChange:e=>{H({blurRadius:e})},min:0,max:100}),t.createElement(p,{label:c("toolbar.brightness"),visible:F,enabled:R.brightnessEnabled,onEnabledChange:e=>{H({brightnessEnabled:e})},numberValue:Math.round(100*R.brightness),onNumberValueChange:e=>{H({brightness:e/100})},min:-100,max:100}),t.createElement(p,{label:c("toolbar.temperature"),visible:F,enabled:R.filters.has("temperature"),onEnabledChange:e=>{W("temperature",e?0:null)},numberValue:Math.round(100*(null!==(g=null===(i=R.filters.get("temperature"))||void 0===i?void 0:i.intensity)&&void 0!==g?g:0)),onNumberValueChange:e=>{W("temperature",e/100)},min:-100,max:100}),t.createElement(p,{label:c("toolbar.contrast"),visible:F,enabled:R.filters.has("contrast"),onEnabledChange:e=>{W("contrast",e?0:null)},numberValue:Math.round(100*(null!==(f=null===(E=R.filters.get("contrast"))||void 0===E?void 0:E.intensity)&&void 0!==f?f:0)),onNumberValueChange:e=>{W("contrast",e/100)},min:-100,max:100}),t.createElement(p,{label:c("toolbar.shadows"),visible:F,enabled:R.filters.has("shadows"),onEnabledChange:e=>{W("shadows",e?0:null)},numberValue:Math.round(100*(null!==(x=null===(v=R.filters.get("shadows"))||void 0===v?void 0:v.intensity)&&void 0!==x?x:0)),onNumberValueChange:e=>{W("shadows",e/100)},min:-100,max:100}),t.createElement(p,{label:c("toolbar.white"),visible:F,enabled:R.filters.has("white"),onEnabledChange:e=>{W("white",e?0:null)},numberValue:Math.round(100*(null!==(C=null===(y=R.filters.get("white"))||void 0===y?void 0:y.intensity)&&void 0!==C?C:0)),onNumberValueChange:e=>{W("white",e/100)},min:-100,max:100}),t.createElement(p,{label:c("toolbar.black"),visible:F,enabled:R.filters.has("black"),onEnabledChange:e=>{W("black",e?0:null)},numberValue:Math.round(100*(null!==(k=null===(w=R.filters.get("black"))||void 0===w?void 0:w.intensity)&&void 0!==k?k:0)),onNumberValueChange:e=>{W("black",e/100)},min:-100,max:100}),t.createElement(p,{label:c("toolbar.vibrance"),visible:F,enabled:R.filters.has("vibrance"),onEnabledChange:e=>{W("vibrance",e?0:null)},numberValue:Math.round(100*(null!==(O=null===(V=R.filters.get("vibrance"))||void 0===V?void 0:V.intensity)&&void 0!==O?O:0)),onNumberValueChange:e=>{W("vibrance",e/100)},min:-100,max:100}),t.createElement(p,{label:c("toolbar.saturation"),visible:F,enabled:R.filters.has("saturation"),onEnabledChange:e=>{W("saturation",e?0:null)},numberValue:Math.round(100*(null!==(I=null===(j=R.filters.get("saturation"))||void 0===j?void 0:j.intensity)&&void 0!==I?I:0)),onNumberValueChange:e=>{W("saturation",e/100)},min:-100,max:100}),P&&t.createElement(o,{checked:!!R.strokeWidth,label:c("toolbar.textStroke"),onChange:e=>{H({strokeWidth:e.target.checked?2:0})},alignIndicator:a.RIGHT,style:{marginTop:"20px"}}),P&&!!R.strokeWidth&&t.createElement(t.Fragment,null,t.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},t.createElement(s,{value:R.stroke,size:30,onChange:e=>{H({stroke:e})},store:e}),t.createElement(l,{defaultValue:R.strokeWidth,onValueChange:e=>{H({strokeWidth:h(e,1,30)})},style:{width:"80px"},min:1,max:Math.round(R.fontSize/2)}))),P&&t.createElement(o,{checked:!!R.backgroundEnabled,label:c("toolbar.textBackground"),onChange:e=>{H({backgroundEnabled:e.target.checked})},alignIndicator:a.RIGHT,style:{marginTop:"20px"}}),P&&!!R.backgroundEnabled&&t.createElement(t.Fragment,null,t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.backgroundCornerRadius")),t.createElement("div",null,t.createElement(NumberInput,{value:100*R.backgroundCornerRadius,onValueChange:e=>{H({backgroundCornerRadius:h(e,0,100)/100})},style:{width:"50px"},min:0,max:100,buttonPosition:"none"}))),t.createElement(r,{value:100*R.backgroundCornerRadius,onChange:e=>{H({backgroundCornerRadius:h(e,0,100)/100})},min:0,max:100,labelRenderer:!1}),t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.backgroundPadding")),t.createElement("div",null,t.createElement(NumberInput,{value:Math.round(100*R.backgroundPadding),onValueChange:e=>{H({backgroundPadding:h(e,0,100)/100})},style:{width:"50px"},min:0,max:100,buttonPosition:"none"}))),t.createElement(r,{value:Math.round(100*R.backgroundPadding),onChange:e=>{H({backgroundPadding:h(e,0,100)/100})},min:0,max:100,labelRenderer:!1}),t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.opacity")),t.createElement("div",null,t.createElement(NumberInput,{value:Math.round(100*R.backgroundOpacity),onValueChange:e=>{H({backgroundOpacity:e/100})},style:{width:"50px"},min:0,max:100,buttonPosition:"none"}))),t.createElement(r,{value:100*R.backgroundOpacity,onChange:e=>{H({backgroundOpacity:e/100})},min:0,max:100,labelRenderer:!1}),t.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",{style:{lineHeight:"30px"}},c("toolbar.color")),t.createElement(s,{value:R.backgroundColor,size:30,onChange:e=>{H({backgroundColor:e})},store:e}))),F&&t.createElement(o,{checked:!!R.borderSize,label:c("toolbar.border"),onChange:e=>{H({borderSize:e.target.checked?2:0})},alignIndicator:a.RIGHT,style:{marginTop:"20px"}}),F&&!!R.borderSize&&t.createElement(t.Fragment,null,t.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},t.createElement(s,{value:R.borderColor,size:30,onChange:e=>{H({borderColor:e})},store:e}),t.createElement(l,{defaultValue:R.borderSize,onValueChange:e=>{H({borderSize:h(e,1,Math.min(R.width,R.height)/2)})},style:{width:"80px"},min:1,max:Math.max(1,Math.min(R.width,R.height)/2)}))),F&&t.createElement(p,{label:c("toolbar.cornerRadius"),visible:F,enabled:0!==R.cornerRadius,onEnabledChange:e=>{H({cornerRadius:e?Math.min(R.width/4,R.height/4):0})},numberValue:Math.min(R.cornerRadius,Math.round(Math.min(R.width/2,R.height/2))),onNumberValueChange:e=>{H({cornerRadius:e})},min:1,max:Math.round(Math.min(R.width/2,R.height/2))}),t.createElement(o,{checked:R.shadowEnabled,label:c("toolbar.shadow"),onChange:e=>{H({shadowEnabled:e.target.checked})},alignIndicator:a.RIGHT,style:{marginTop:"20px"}}),R.shadowEnabled&&t.createElement(t.Fragment,null,t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.blur")),t.createElement("div",null,t.createElement(NumberInput,{value:R.shadowBlur,onValueChange:e=>{H({shadowBlur:h(e,-50,50)})},style:{width:"50px"},min:0,max:50,buttonPosition:"none"}))),t.createElement("div",null,t.createElement(r,{value:R.shadowBlur,onChange:e=>{H({shadowBlur:e})},min:0,max:50,showTrackFill:!1,labelRenderer:!1})),t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.offsetX")),t.createElement("div",null,t.createElement(NumberInput,{value:R.shadowOffsetX,onValueChange:e=>{H({shadowOffsetX:h(e,-50,50)})},style:{width:"50px"},min:-50,max:50,buttonPosition:"none"}))),t.createElement("div",null,t.createElement(r,{value:R.shadowOffsetX,onChange:e=>{H({shadowOffsetX:e})},min:-50,max:50,showTrackFill:!1,labelRenderer:!1})),t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.offsetY")),t.createElement("div",null,t.createElement(NumberInput,{value:R.shadowOffsetY,onValueChange:e=>{H({shadowOffsetY:h(e,-50,50)})},style:{width:"50px"},min:-50,max:50,buttonPosition:"none"}))),t.createElement("div",null,t.createElement(r,{value:R.shadowOffsetY,onChange:e=>{H({shadowOffsetY:e})},min:-50,max:50,showTrackFill:!1,labelRenderer:!1})),t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,c("toolbar.opacity")),t.createElement("div",null,t.createElement(NumberInput,{value:Math.round(100*R.shadowOpacity),onValueChange:e=>{H({shadowOpacity:e/100})},style:{width:"50px"},min:0,max:100,buttonPosition:"none"}))),t.createElement("div",null,t.createElement(r,{value:100*R.shadowOpacity,onChange:e=>{H({shadowOpacity:e/100})},min:0,max:100,labelRenderer:!1})),t.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",{style:{lineHeight:"30px"}},c("toolbar.color")),t.createElement(s,{value:R.shadowColor,size:30,onChange:e=>{H({shadowColor:e})},store:e}))))});