import e from"react";import{observer as t}from"mobx-react-lite";import{Button as l,EditableText as n,Card as i}from"@blueprintjs/core";import{t as a}from"../utils/l10n.js";import{isMobile as r}from"../utils/screen.js";import{ReactSortable as o}from"react-sortablejs";import{removeTags as s}from"../utils/text.js";import{DragHandleVertical as d,Trash as m,Lock as c,Unlock as p,EyeOpen as u,EyeOff as E}from"@blueprintjs/icons";const v=t(({element:t,store:r})=>{const o=r.selectedElements.indexOf(t)>=0,[v,y]=e.useState(!1),x=()=>y(!1),g=v?t.name:t.name||s(t.text)||`#${t.id}`;return e.createElement(i,{onMouseDown:e=>{const l=e.ctrlKey||e.metaKey||e.shiftKey?[...r.selectedElementsIds]:[];l.indexOf(t.id)<0&&l.push(t.id),r.selectElements(l)},className:o?"selected":"",style:{padding:"5px",margin:"0px 1px 5px 1px",backgroundColor:o?"rgb(0, 161, 255, 0.2)":"",display:t.selectable||"admin"===r.role?"auto":"none"}},e.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},e.createElement("div",{style:{lineHeight:"30px",display:"flex"}},e.createElement("div",{className:"drag-handle",style:{display:"flex",justifyContent:"center",alignItems:"center",cursor:"move",height:"30px"}},e.createElement(d,null)),e.createElement("div",{style:{padding:"0 7px",opacity:.5,width:"60px"}},a("sidePanel.layerTypes."+t.type)),e.createElement("div",{style:{maxWidth:"142px"}},e.createElement(n,{minWidth:130,placeholder:a("sidePanel.namePlaceholder"),value:g,maxLines:1,onEdit:()=>y(!0),onCancel:x,onConfirm:x,onChange:e=>{t.set({name:e})}}))),e.createElement("div",null,e.createElement(l,{minimal:!0,icon:(null==t?void 0:t.visible)?e.createElement(u,null):e.createElement(E,null),onClick:()=>{t.set({visible:!t.visible})}}),e.createElement(l,{minimal:!0,icon:(null==t?void 0:t.locked)?e.createElement(c,null):e.createElement(p,null),onClick:()=>{t.set({draggable:t.locked,contentEditable:t.locked,styleEditable:t.locked,resizable:t.locked,removable:t.locked})}}),e.createElement(l,{icon:e.createElement(m,null),minimal:!0,disabled:!t.removable,onClick:()=>{r.deleteElements([t.id])},style:{marginLeft:"auto"}}))))});export const LayersPanel=t(({store:t})=>{var l;const n=(null===(l=t.activePage)||void 0===l?void 0:l.children.map(e=>({id:e.id})))||[];n.reverse();const i=r();return e.createElement("div",{style:{height:"100%",overflow:"auto"}},e.createElement("div",{style:{height:"40px",paddingTop:"5px"}},a("sidePanel.layersTip")),e.createElement("div",null,0===n.length?e.createElement("div",null,a("sidePanel.noLayers")):null,e.createElement(o,{list:n,setList:e=>{e.forEach(({id:l},n)=>{var i,a;const r=e.length-n-1,o=t.getElementById(l);(null===(i=t.activePage)||void 0===i?void 0:i.children.indexOf(o))!==r&&(null===(a=t.activePage)||void 0===a||a.setElementZIndex(o.id,r))})},direction:"horizontal",handle:i?".drag-handle":void 0},n.map(({id:l})=>{const n=t.getElementById(l);return e.createElement(v,{element:n,store:t,key:l})}))))});