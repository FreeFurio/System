import e from"react";import{observer as t}from"mobx-react-lite";import{Switch as r,Alignment as i,InputGroup as o}from"@blueprintjs/core";import{nanoid as a}from"nanoid";import{forEveryChild as s}from"../model/group-model.js";import{Search as l}from"@blueprintjs/icons";import{t as n}from"../utils/l10n.js";import{ImagesGrid as m}from"./images-grid.js";import{templateList as c}from"../utils/api.js";import{useInfiniteAPI as p}from"../utils/use-api.js";const g=(t,r)=>{const i=e.useRef(!0);e.useEffect(()=>{i.current?i.current=!1:t()},r)},h=t(({sizeQuery:t,query:r,store:i})=>{const{setQuery:o,loadMore:l,hasMore:n,data:h,isLoading:d,reset:u,error:f}=p({getAPI:({page:e,query:r})=>c({page:e,query:r,sizeQuery:t}),getSize:e=>e.totalPages});return g(()=>{u()},[t]),g(()=>{o(r)},[r]),e.createElement(m,{images:null==h?void 0:h.map(e=>e.items).flat(),getPreview:e=>e.preview,isLoading:d,onSelect:async e=>{const t=await fetch(e.json),r=await t.json();if(i.pages.length<=1){i.loadJSON(r,!0)}else{const e=JSON.parse(JSON.stringify(i.toJSON()));e.width===r.width&&e.height===r.height||r.pages.forEach(e=>{e.width=e.width||r.width,e.height=e.height||r.height}),s({children:r.pages},e=>{e.id=a(10)});const t=i.pages.indexOf(i.activePage);e.pages.splice(t,1,...r.pages),i.loadJSON(e,!0)}},loadMore:n&&l,error:f})});export const TemplatesPanel=t(({store:t})=>{const[a,s]=e.useState(!0),[m,c]=e.useState(""),p=a?`${t.width}x${t.height}`:"all";return e.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},e.createElement(o,{leftIcon:e.createElement(l,null),placeholder:n("sidePanel.searchPlaceholder"),type:"search",onChange:e=>{c(e.target.value)},style:{marginBottom:"20px"}}),e.createElement(r,{checked:a,onChange:e=>{s(e.target.checked)},alignIndicator:i.RIGHT,style:{marginTop:"8px",marginBottom:"25px"}},n("sidePanel.searchTemplatesWithSameSize")," "),e.createElement(h,{store:t,sizeQuery:"size="+p,query:m}))});