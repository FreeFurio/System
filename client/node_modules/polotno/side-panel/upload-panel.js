import e from"react";import{Button as t}from"@blueprintjs/core";import{Plus as o}from"@blueprintjs/icons";import{getVideoPreview as i}from"../utils/video.js";import{localFileToURL as r}from"../utils/file.js";import{ImagesGrid as n}from"./images-grid.js";import{t as s}from"../utils/l10n.js";import{selectImage as l}from"./select-image.js";import{selectVideo as c}from"./select-video.js";import{selectSvg as a}from"./select-svg.js";import{selectGif as d}from"./select-gif.js";let m=async e=>r(e);export function setUploadFunc(e){m=e}let p=[];function f(e){const{type:t}=e;return t.indexOf("svg")>=0?"svg":t.indexOf("gif")>=0?"gif":t.indexOf("image")>=0?"image":t.indexOf("video")>=0?"video":t.indexOf("audio")>=0?"audio":"image"}function u(){const e=new Blob(['\n    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" r="45" fill="#f0f0f0" stroke="#ccc" stroke-width="2"/>\n      <path d="M40,35 L40,65 L55,50 L70,50 M70,35 Q80,50 70,65" fill="none" stroke="#666" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n  '],{type:"image/svg+xml"});return URL.createObjectURL(e)}export const UploadPanel=({store:r})=>{const[g,v]=e.useState(p),[y,h]=e.useState(!1),x=e.useRef(null);return e.useEffect(()=>{p=g},[g]),e.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},e.createElement("div",{style:{height:"45px",paddingTop:"5px"}},s("sidePanel.uploadTip")),e.createElement("div",{style:{marginBottom:"20px"}},e.createElement("label",{htmlFor:"input-file"},e.createElement(t,{icon:e.createElement(o,null),style:{width:"100%"},onClick:()=>{var e;null===(e=x.current)||void 0===e||e.click()}},s("sidePanel.uploadImage")),e.createElement("input",{type:"file",ref:x,style:{display:"none"},onChange:async e=>{const{target:t}=e;h(!0);try{for(const e of t.files){const t=await m(e),o=f(e);let r=t;"video"===o?r=await i(t):"audio"===o&&(r=u()),v(e=>e.concat([{url:t,type:o,preview:r}]))}}catch(e){console.error(e)}h(!1),t.value=""},multiple:!0}))),e.createElement(n,{images:g,isLoading:y,getPreview:e=>e.preview,hideNoResults:!0,onSelect:async(e,t,o)=>{const i=e.url,n=e.type;"image"===n?l({src:i,store:r,droppedPos:t,targetElement:o}):"video"===n?c({src:i,store:r,droppedPos:t,targetElement:o}):"gif"===n?d({src:i,store:r,droppedPos:t,targetElement:o}):"svg"===n?a({src:i,store:r,droppedPos:t,targetElement:o}):"audio"===n&&r.addAudio({src:i})}}))};