import e from"react";import{observer as t}from"mobx-react-lite";import{Button as o,Dialog as r,Classes as n}from"@blueprintjs/core";import{removeBackground as a}from"../utils/api.js";import{t as c}from"../utils/l10n.js";let l=async e=>{const t=await fetch(a(),{method:"POST",body:JSON.stringify({url:e})});return 200!==t.status?(alert(c("error.removeBackground")),e):(await t.json()).url};export function setRemoveBackgroundFunc(e){l=e}export const RemoveBackgroundDialog=t(({isOpen:t,onClose:a,element:m})=>{const[i,s]=e.useState(m.src);e.useEffect(()=>{s(m.src)},[m.src]);const[u,d]=e.useState(!1),g=i!==m.src;return e.createElement(r,{onClose:a,title:c("toolbar.removeBackgroundTitle"),isOpen:t,style:{width:"80%",maxWidth:"700px"}},e.createElement("div",{className:n.DIALOG_BODY},e.createElement("img",{src:i,style:{width:"100%",maxHeight:"400px",objectFit:"contain"}})),e.createElement("div",{className:n.DIALOG_FOOTER,style:{position:"relative"}},e.createElement("div",{className:n.DIALOG_FOOTER_ACTIONS},!g&&e.createElement(o,{onClick:async()=>{d(!0);try{s(await l(m.src))}catch(e){console.error(e)}d(!1)},loading:u},c("toolbar.removeBackground")),g&&e.createElement(e.Fragment,null,e.createElement(o,{onClick:()=>{s(m.src),a()},loading:u},c("toolbar.cancelRemoveBackground")),e.createElement(o,{onClick:()=>{m.set({src:i}),a()},loading:u,intent:"primary"},c("toolbar.confirmRemoveBackground"))))))});export const ImageRemoveBackground=({element:t})=>{const[r,n]=e.useState(!1);return e.createElement(e.Fragment,null,e.createElement(o,{text:c("toolbar.removeBackground"),minimal:!0,onClick:e=>{n(!0)}}),e.createElement(RemoveBackgroundDialog,{isOpen:r,onClose:()=>{n(!1)},element:t}))};