import e from"react";import{ReactCSS as t}from"reactcss";import r from"lodash/merge.js";import{Button as o}from"@blueprintjs/core";import n from"@meronex/icons/cg/CgColorPicker.js";import i from"konva";import{ColorWrap as a,Saturation as s,Hue as l,Alpha as c,Checkboard as d}from"react-color/lib/components/common/index.js";import{SketchFields as p}from"react-color/lib/components/sketch/SketchFields.js";import{SketchPresetColors as m}from"react-color/lib/components/sketch/SketchPresetColors.js";const h=t=>{const r=e.useRef(t);return r.current=t,e.useCallback((...e)=>r.current(...e),[])};export const Sketch=({width:a=200,rgb:u,hex:g,hsv:x,hsl:f,onChange:b,onSwatchHover:v,disableAlpha:E=!1,presetColors:w=["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"],renderers:C,styles:k={},className:y=""})=>{const A=t(r({default:Object.assign({picker:{width:a,padding:"10px 10px 0",boxSizing:"initial",background:"#fff",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.15), 0 8px 16px rgba(0,0,0,.15)"},saturation:{width:"100%",paddingBottom:"75%",position:"relative",overflow:"hidden"},Saturation:{radius:"3px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},controls:{display:"flex"},sliders:{padding:"4px 0",flex:"1"},color:{width:"24px",height:"24px",position:"relative",marginTop:"4px",marginLeft:"4px",borderRadius:"3px"},activeColor:{absolute:"0px 0px 0px 0px",borderRadius:"2px",background:`rgba(${u.r},${u.g},${u.b},${u.a})`,boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},hue:{position:"relative",height:"10px",overflow:"hidden"},Hue:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},alpha:{position:"relative",height:"10px",marginTop:"4px",overflow:"hidden"},Alpha:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"}},k),disableAlpha:{color:{height:"10px"},hue:{height:"10px"},alpha:{display:"none"}}},k),{disableAlpha:E}),[S,B]=e.useState(!1),F=e.useRef(null),R=h(e=>{var t;if(S){const r=null===(t=F.current)||void 0===t?void 0:t.fill();r&&b(i.Util.colorToRGBA(r)),j(),function(e){let t=e.target;for(;t;){if(t.classList.contains("color-picker-button")){return!0}t=t.parentElement}return!1}(e)||B(!1),e.stopPropagation(),e.stopImmediatePropagation()}}),L=h(e=>{if(!S){return}const t=i.stages.find(t=>{const r=t.getContent().parentElement.parentElement.getBoundingClientRect();return r.left<e.clientX&&r.left+r.width>e.clientX&&r.top<e.clientY&&r.top+r.height>e.clientY});if(!t){return void j()}const r=t.getContent().getBoundingClientRect(),o=e.clientX-r.left,n=e.clientY-r.top,a=t.children[0],s=a.getNativeCanvasElement(),l=a.getCanvas().getPixelRatio(),{data:c}=s.getContext("2d").getImageData(o*l,n*l,1,1),d=t.findOne(".line-guides");d.findOne(".picker")||(F.current&&F.current.destroy(),F.current=new i.Circle({name:"picker",radius:14,stroke:"black",strokeWidth:1}),d.add(F.current)),F.current.setAbsolutePosition({x:o-15,y:n-15}),F.current.fill("rgb("+c[0]+","+c[1]+","+c[2]+")")});e.useEffect(()=>(window.addEventListener("mousemove",L),window.addEventListener("mousedown",R,!0),window.addEventListener("touchstart",R,!0),()=>{window.removeEventListener("mousemove",L),window.removeEventListener("mousedown",R,!0),window.removeEventListener("touchstart",R,!0),j()}),[]),e.useEffect(()=>{S||j()},[S]),e.useEffect(()=>(S&&(document.body.style.cursor="crosshair"),()=>{document.body.style.cursor="default"}),[S]);const j=h(()=>{F.current&&(F.current.destroy(),F.current=null)});return e.createElement("div",{style:A.picker,className:`sketch-picker ${y}`},e.createElement("div",{style:A.saturation},e.createElement(s,{style:A.Saturation,hsl:f,hsv:x,onChange:b})),e.createElement("div",{style:A.controls,className:"flexbox-fix"},e.createElement("div",{style:A.sliders},e.createElement("div",{style:A.hue},e.createElement(l,{style:A.Hue,hsl:f,onChange:b})),e.createElement("div",{style:A.alpha},e.createElement(c,{style:A.Alpha,rgb:u,hsl:f,renderers:C,onChange:b}))),e.createElement("div",{style:A.color},e.createElement(d,{size:8,white:"transparent",grey:"rgba(0,0,0,.08)"}),e.createElement("div",{style:A.activeColor})),e.createElement("div",{style:A.color},e.createElement(o,{icon:e.createElement(n,null),className:"color-picker-button",minimal:!0,style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px",padding:0,margin:0},active:S,onClickCapture:e=>{B(e=>!e),e.stopPropagation()}}))),e.createElement(p,{rgb:u,hsl:f,hex:g,onChange:b,disableAlpha:E}),e.createElement(m,{colors:w,onClick:b,onSwatchHover:v}))};export default a(Sketch);