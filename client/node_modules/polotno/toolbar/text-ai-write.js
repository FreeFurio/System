import e from"react";import{observer as t}from"mobx-react-lite";import{Button as a,Position as o,Menu as l,MenuItem as n,MenuDivider as r,TextArea as i}from"@blueprintjs/core";import{Clean as c}from"@blueprintjs/icons";import{Popover as s,Dialog as m}from"@blueprintjs/core";import{t as d}from"../utils/l10n.js";import{URLS as x}from"../utils/api.js";const u=async({text:e="",command:t,tone:a})=>{try{const o=await fetch(x.aiText(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,command:t,tone:a})});if(!o.ok){const e=await o.text();throw console.error(e),new Error("Failed to rewrite text")}return(await o.json()).response}catch(o){return console.error(o),e}},p=[{text:"friendly"},{text:"professional"},{text:"humorous"},{text:"formal"}];export const TextAiWrite=t(({store:t})=>{const x=t.selectedElements.length>0,[E,b]=e.useState(!1),[f,g]=e.useState(!1),[T,y]=e.useState(1),[h,C]=e.useState(""),[k,v]=e.useState(""),[w,N]=e.useState(!1),S=e.useRef(null),j=t.selectedElements.some(e=>!e.contentEditable);e.useEffect(()=>{f&&1===T&&setTimeout(()=>{var e;null===(e=S.current)||void 0===e||e.focus()},100)},[f,T]);const O=async(e,a)=>{b(!0);const o=t.selectedElements[0].id,l=t.selectedElements[0].text,n=await u({text:l,command:e,tone:a}),r=t.getElementById(o);r&&(r.set({text:n}),b(!1))},P=async()=>{N(!0);const e=await u({command:"custom",tone:h});v(e),N(!1),y(2)};return j?null:E?e.createElement(a,{icon:e.createElement(c,null),minimal:!0,text:"AI write",loading:!0}):e.createElement(e.Fragment,null,e.createElement(s,{disabled:!x,content:e.createElement(l,null,e.createElement(n,{text:d("toolbar.aiText.rewrite"),onClick:()=>{O("rewrite")}}),e.createElement(n,{text:d("toolbar.aiText.shorten"),onClick:()=>{O("shorten")}}),e.createElement(n,{text:d("toolbar.aiText.continue"),onClick:()=>{O("continue")}}),e.createElement(n,{text:d("toolbar.aiText.proofread"),onClick:()=>{O("proofread")}}),e.createElement("li",{className:"bp5-menu-header"},e.createElement("h6",{className:"bp5-heading"},d("toolbar.aiText.tones"))),p.map(t=>e.createElement(n,{key:t.text,text:d(`toolbar.aiText.${t.text}`),onClick:()=>{O("tone",t.text)}})),e.createElement(r,null),e.createElement(n,{text:d("toolbar.aiText.customPrompt"),onClick:e=>{e.preventDefault(),e.stopPropagation(),g(!0)}})),position:o.BOTTOM},e.createElement(a,{icon:e.createElement(c,null),minimal:!0,text:d("toolbar.aiText.aiWrite")})),e.createElement(m,{isOpen:f,onClose:()=>{w||(g(!1),y(1),C(""),v(""))},title:d(1===T?"toolbar.aiText.customPrompt":"toolbar.aiText.generatedResult")},1===T?e.createElement("div",{className:"bp5-dialog-body"},e.createElement(i,{inputRef:S,value:h,onChange:e=>C(e.target.value),placeholder:d("toolbar.aiText.promptPlaceholder"),fill:!0,disabled:w,style:{minHeight:100}}),e.createElement("div",{className:"bp5-dialog-footer"},e.createElement("div",{className:"bp5-dialog-footer-actions"},e.createElement(a,{onClick:()=>g(!1),text:d("toolbar.aiText.cancel"),disabled:w}),e.createElement(a,{intent:"primary",onClick:P,loading:w,disabled:!h,text:d("toolbar.aiText.generate")})))):e.createElement("div",{className:"bp5-dialog-body"},e.createElement(i,{value:k,onChange:e=>v(e.target.value),fill:!0,growVertically:!0,style:{minHeight:100}}),e.createElement("div",{className:"bp5-dialog-footer"},e.createElement("div",{className:"bp5-dialog-footer-actions"},e.createElement(a,{onClick:()=>y(1),text:d("toolbar.aiText.back"),disabled:w}),e.createElement(a,{onClick:P,text:d("toolbar.aiText.tryAgain"),loading:w}),e.createElement(a,{intent:"primary",onClick:()=>{const e=t.selectedElements[0].id,a=t.getElementById(e);a&&a.set({text:k}),g(!1),y(1),C(""),v("")},text:d("toolbar.aiText.insert"),disabled:w}))))))});