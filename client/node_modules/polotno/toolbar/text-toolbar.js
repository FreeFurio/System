var e=this&&this.__rest||function(e,t){var n={};for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o])}if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++){t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}}return n};import t from"react";import{observer as n}from"mobx-react-lite";import{Button as o,ButtonGroup as r,InputGroup as i,Menu as l,MenuDivider as a,MenuItem as c,NumericInput as s,Popover as m,Position as p,Slider as f,Tooltip as u}from"@blueprintjs/core";import{FixedSizeList as d}from"react-window";import h from"swr";import{AlignCenter as x,AlignJustify as g,AlignLeft as E,AlignRight as y,Bold as T,CaretDown as v,Italic as b,Search as F,Strikethrough as S,Underline as w}from"@blueprintjs/icons";import{getFontsList as C,globalFonts as O,isGoogleFontChanged as j}from"../utils/fonts.js";import{getGoogleFontImage as N,getGoogleFontsListAPI as D}from"../utils/api.js";import M from"./color-picker.js";import k from"./filters-picker.js";import{AnimationsPicker as I}from"./animations-picker.js";import{ElementContainer as V,extendToolbar as A}from"./element-container.js";import{TextAiWrite as z}from"./text-ai-write.js";import P from"@meronex/icons/mdc/MdcFormatLineSpacing.js";import L from"@meronex/icons/mdc/MdcFormatLetterCase.js";import R from"../utils/styled.js";import _ from"@meronex/icons/mdc/MdcFormatVerticalAlignTop.js";import W from"@meronex/icons/mdc/MdcFormatVerticalAlignCenter.js";import H from"@meronex/icons/mdc/MdcFormatVerticalAlignBottom.js";import{t as G}from"../utils/l10n.js";import{flags as B}from"../utils/flags.js";const q=R("img")`
  height: 20px;

  .bp5-dark & {
    filter: invert(1);
  }
`,J=C(),K=({fontFamily:e,handleClick:n,modifiers:o,store:r,isCustom:i})=>{const[l,s]=t.useState(!i);if(t.useEffect(()=>{l||r.loadFont(e)},[e,l]),"_divider"===e){return t.createElement("div",{style:{paddingTop:"10px"}},t.createElement(a,null))}const m=l?t.createElement(q,{src:N(e),alt:e,onError:()=>{s(!1)}}):e;return t.createElement(c,{text:m,active:o.active,disabled:o.disabled,onClick:n,style:{fontFamily:'"'+e+'"'}})},Q=({onChange:e,defaultValue:n})=>{const o=t.useRef(null);return t.useEffect(()=>{o.current&&o.current.focus()},[]),t.createElement(i,{leftIcon:t.createElement(F,null),inputRef:o,defaultValue:n,onChange:t=>e(t.target.value)})},U=({store:e,fonts:n,activeFont:r,activeFontLabel:i,onFontSelect:a})=>{const[c,s]=t.useState(""),p=n.filter(e=>e.toLowerCase().indexOf(c.toLowerCase())>=0);return t.createElement(m,{content:t.createElement("div",null,t.createElement(Q,{onChange:e=>s(e),defaultValue:c}),t.createElement("div",{style:{paddingTop:"5px"}},t.createElement(d,{innerElementType:t.forwardRef((e,n)=>t.createElement(l,Object.assign({ref:n},e))),height:Math.min(400,30*p.length)+10,width:210,itemCount:p.length,itemSize:30,children:({index:n,style:o})=>{const i=p[n];return t.createElement("div",{style:o},t.createElement(K,{key:i,fontFamily:i,modifiers:{active:r===i},handleClick:()=>a(i),store:e,isCustom:e.fonts.find(e=>e.fontFamily===i)||O.find(e=>e.fontFamily===i)}))}})))},t.createElement(o,{text:i,rightIcon:t.createElement(v,null),minimal:!0,style:{marginRight:"5px",fontFamily:'"'+r+'"',overflow:"hidden",whiteSpace:"nowrap",maxHeight:"30px"}}))},X={};export const fetcher=e=>X[e]?Promise.resolve(X[e]):fetch(e).then(e=>e.json()).then(t=>(X[e]=t,t));export const TextFontFamily=n(({elements:e,store:n})=>{const{data:o,mutate:r}=h(D(),fetcher,{isPaused:()=>j(),fallbackData:[]});t.useEffect(()=>{r()},[j()]);const i=n.fonts.concat(O).map(e=>e.fontFamily).concat((null==o?void 0:o.length)&&!j()?o:J);let l=e[0].fontFamily;l.length>15&&(l=l.slice(0,15)+"...");const a=[];n.find(e=>("text"===e.type&&a.push(e.fontFamily),!1));const c=[...new Set(a.concat("_divider").concat(i))];return t.createElement(U,{fonts:c,activeFont:e[0].fontFamily,activeFontLabel:l,store:n,onFontSelect:t=>{n.history.transaction(()=>{e.forEach(e=>{e.set({fontFamily:t})})})}})});export const TextFontSize=n(({elements:e,store:n})=>t.createElement(s,{onValueChange:t=>{Number.isNaN(t)||n.history.transaction(()=>{e.forEach(e=>{e.set({fontSize:t,width:Math.max(t,e.width)})})})},value:Math.round(e[0].fontSize),style:{width:"50px"},min:5,max:4*n.height}));export const ALIGN_OPTIONS=["left","center","right","justify"];const Y=["top","middle","bottom"],Z={top:t.createElement("span",{className:"bp5-icon"},t.createElement(_,null)),middle:t.createElement("span",{className:"bp5-icon"},t.createElement(W,null)),bottom:t.createElement("span",{className:"bp5-icon"},t.createElement(H,null))};export const TextFontVariant=n(({elements:e,store:n})=>{const i=e[0];return t.createElement(r,null,t.createElement(o,{minimal:!0,icon:"left"===i.align?t.createElement(E,null):"center"===i.align?t.createElement(x,null):"right"===i.align?t.createElement(y,null):t.createElement(g,null),onMouseDown:e=>{e.preventDefault()},onClick:()=>{const t=(ALIGN_OPTIONS.indexOf(i.align)+1+ALIGN_OPTIONS.length)%ALIGN_OPTIONS.length,o=ALIGN_OPTIONS[t];n.history.transaction(()=>{e.forEach(e=>{e.set({align:o})})})}}),B.textVerticalResizeEnabled&&t.createElement(o,{minimal:!0,icon:Z[i.verticalAlign],onMouseDown:e=>{e.preventDefault()},onClick:()=>{const t=(Y.indexOf(i.verticalAlign)+1+Y.length)%Y.length,o=Y[t];n.history.transaction(()=>{e.forEach(e=>{e.set({verticalAlign:o})})})}}),t.createElement(o,{minimal:!0,icon:t.createElement(T,null),active:"bold"===i.fontWeight||"700"===i.fontWeight,onMouseDown:e=>{e.preventDefault()},onClick:()=>{const t="bold"===i.fontWeight||"700"===i.fontWeight;n.history.transaction(()=>{e.forEach(e=>{t?e.set({fontWeight:"normal"}):e.set({fontWeight:"bold"})})})}}),t.createElement(o,{minimal:!0,icon:t.createElement(b,null),active:"italic"===i.fontStyle,onMouseDown:e=>{e.preventDefault()},onClick:()=>{const t="italic"===i.fontStyle;n.history.transaction(()=>{e.forEach(e=>{t?e.set({fontStyle:"normal"}):e.set({fontStyle:"italic"})})})}}),t.createElement(o,{minimal:!0,icon:t.createElement(w,null),active:i.textDecoration.indexOf("underline")>=0,onMouseDown:e=>{e.preventDefault()},onClick:()=>{let t=i.textDecoration.split(" ");t.indexOf("underline")>=0?t=t.filter(e=>"underline"!==e):t.push("underline"),n.history.transaction(()=>{e.forEach(e=>{e.set({textDecoration:t.join(" ")})})})}}),t.createElement(o,{minimal:!0,icon:t.createElement(S,null),active:i.textDecoration.indexOf("line-through")>=0,onMouseDown:e=>{e.preventDefault()},onClick:()=>{let t=i.textDecoration.split(" ");t.indexOf("line-through")>=0?t=t.filter(e=>"line-through"!==e):t.push("line-through"),n.history.transaction(()=>{e.forEach(e=>{e.set({textDecoration:t.join(" ")})})})}}))});export const TextTransform=n(({elements:e,store:n})=>t.createElement(r,null,t.createElement(u,{content:G("toolbar.uppercase")},t.createElement(o,{variant:"minimal",active:"uppercase"==e[0].textTransform,icon:t.createElement(L,{size:16,className:"bp5-icon"}),onMouseDown:e=>{e.preventDefault()},onClick:()=>{n.history.transaction(()=>{e.forEach(e=>{e.set({textTransform:"uppercase"===e.textTransform?"none":"uppercase"})})})}}))));export const TextFill=n(({elements:e,store:n})=>t.createElement(M,{value:e[0].fill,style:{marginRight:"5px"},gradientEnabled:!0,onChange:t=>n.history.transaction(()=>{e.forEach(e=>{e.set({fill:t})})}),store:n}));export const NumberInput=n=>{var{value:o,onValueChange:r}=n,i=e(n,["value","onValueChange"]);const[l,a]=t.useState(o.toString());return t.useEffect(()=>{a(o.toString())},[o]),t.createElement(s,Object.assign({value:l,onValueChange:(e,t)=>{a(t),Number.isNaN(e)||r(e)}},i))};export const TextSpacing=n(({elements:e,store:n})=>{const r=e[0],i=t=>{n.history.transaction(()=>{e.forEach(e=>{e.set(t)})})},l="number"==typeof r.lineHeight?100*r.lineHeight:120;return t.createElement(m,{content:t.createElement("div",{style:{padding:"15px",width:"230px"}},t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,G("toolbar.lineHeight")),t.createElement("div",null,t.createElement(NumberInput,{value:Math.round(l),onValueChange:e=>{i({lineHeight:e/100})},style:{width:"50px"},min:50,max:250,buttonPosition:"none"}))),t.createElement(f,{value:Math.round(l),onChange:e=>{i({lineHeight:e/100})},min:50,max:250,stepSize:1,showTrackFill:!1,labelRenderer:!1}),t.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:"5px",paddingBottom:"5px"}},t.createElement("div",null,G("toolbar.letterSpacing")),t.createElement("div",null,t.createElement(NumberInput,{value:Math.round(100*r.letterSpacing),onValueChange:e=>{i({letterSpacing:e/100})},style:{width:"50px"},min:-50,max:250,buttonPosition:"none"}))),t.createElement(f,{value:Math.round(100*r.letterSpacing),onChange:e=>{i({letterSpacing:e/100})},min:-50,max:250,stepSize:1,showTrackFill:!1,labelRenderer:!1})),position:p.BOTTOM},t.createElement(o,{icon:t.createElement(P,{className:"bp5-icon",style:{fontSize:"20px"}}),minimal:!0}))});const $={TextFontFamily,TextFontSize,TextFontVariant,TextTransform,TextFill,TextSpacing,TextAiWrite:z,TextFilters:k,TextAnimations:I};export const TextToolbar=n(({store:e,components:n})=>{const o=e.selectedElements,r=["TextFill","TextFontFamily","TextFontSize","TextFontVariant","TextSpacing","TextTransform","TextFilters",B.animationsEnabled&&"TextAnimations","TextAiWrite"],i=A({type:"text",usedItems:r,components:n});return t.createElement(V,{items:i,itemRender:r=>{const i=n[r]||$[r];return t.createElement(i,{elements:o,element:o[0],store:e,key:r})}})});export default TextToolbar;