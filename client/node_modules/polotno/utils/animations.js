import{rotateAroundCenter as t}from"./math.js";const o={right:{from:{x:-200},to:{x:0}},left:{from:{x:200},to:{x:0}},up:{from:{y:200},to:{y:0}},down:{from:{y:-200},to:{y:0}},"bottom-right":{from:{x:-200,y:-200},to:{x:0,y:0}},"bottom-left":{from:{x:200,y:-200},to:{x:0,y:0}},"top-right":{from:{x:-200,y:200},to:{x:0,y:0}},"top-left":{from:{x:200,y:200},to:{x:0,y:0}}},i={right:{cropX:-1},left:{cropX:1},up:{cropY:1},down:{cropY:-1}};export const animations={fade:({dTime:t,element:o,animation:i})=>{const n=t/i.duration;return"enter"===i.type?{opacity:n*o.opacity}:{opacity:(1-n)*o.opacity}},rotate:({dTime:o,element:i,animation:n})=>{const e=o/n.duration*360;return t({x:i.x,y:i.y,width:i.width,height:i.height,rotation:i.rotation},e)},blink:({dTime:t,element:o,animation:i})=>{const n=i.duration,e=t%n/(n/2),a=e<=1?e:2-e;return{opacity:o.opacity*a}},bounce:({dTime:t,element:o,animation:i})=>{var n;const e=i.duration,a=e/2,r=null!==(n=i.data.strength)&&void 0!==n?n:1,h={},m={x:o.x+o.width/3*r,y:o.y+o.height/3*r,width:o.width/3*r,height:o.height/3*r,fontSize:o.fontSize/3*r},c={x:o.x,y:o.y,width:o.width,height:o.height,fontSize:o.fontSize},d=t%e/a,p=d<=1?d:2-d;for(let s in m){const t=m[s],o=c[s]-t;h[s]=t+p*o}return h},move:({dTime:t,element:i,animation:n})=>{var e;const a=o[n.data.direction]||o.right,r=null!==(e=n.data.strength)&&void 0!==e?e:1,h={};for(var m in a.from){let o=a.from[m],e=a.to[m];"exit"===n.type&&(o=a.to[m],e=-a.from[m]),o*=r,e*=r;const c=i[m]+o,d=i[m]+e-c;h[m]=c+t/n.duration*d}return h},zoom:({dTime:t,element:o,animation:i})=>{var n;const e={},a=1+(("in"===(i.data.direction||"in")?3/4:5/4)-1)*(null!==(n=i.data.strength)&&void 0!==n?n:1),r=o.rotation*Math.PI/180,h=Math.cos(r),m=Math.sin(r),c=o.width*(1-a),d=o.height*(1-a),p=(c*h-d*m)/2,s=(c*m+d*h)/2,l={x:o.x+p,y:o.y+s,width:o.width*a,height:o.height*a,fontSize:o.fontSize*a},y={x:o.x,y:o.y,width:o.width,height:o.height,fontSize:o.fontSize};for(var f in l){let o=l[f],n=y[f];if("exit"===i.type){const t=o;o=n,n=t}const a=n-o;e[f]=o+t/i.duration*a}return e},cameraZoom:({dTime:t,element:o,animation:n})=>{var e,a,r;const h={},m=n.data.direction||"right",c=i[m]||i.right,d=null!==(e=n.data.movementStrength)&&void 0!==e?e:.1,p=null!==(a=n.data.shakeStrength)&&void 0!==a?a:.015;let s=null!==(r=n.data.zoomStrength)&&void 0!==r?r:.6;const l=t/n.duration,y=p*(1-l),f=Math.sin(12*l)*y*.7+Math.sin(8*l)*y*.3;if("exit"===n.type){const t=Math.max(o.cropWidth||1,o.cropHeight||1);s=Math.min(s,1-t)}n.type;const x=1-Math.pow(1-l,2),g=o.cropX||0,u=o.cropY||0,w=o.cropWidth||1,M=o.cropHeight||1,v=w,S=M;let z,T,X=0,Y=0;if(c.cropX){const t=c.cropX>0?1-(g+w):g;X=Math.min(t,Math.abs(d))*c.cropX}if(c.cropY){const t=c.cropY>0?1-(u+M):u;Y=Math.min(t,Math.abs(d))*c.cropY}return"enter"===n.type?(z=c.cropX?g+X*(1-x):g,T=c.cropY?u+Y*(1-x):u):(z=c.cropX?g+X*x:g,T=c.cropY?u+Y*x:u),h.cropX=Math.max(0,Math.min(1-v,z+f*v)),h.cropY=Math.max(0,Math.min(1-S,T+f*S)),h.cropWidth=v,h.cropHeight=S,h}};export const animate=({element:t,dTime:o,animation:i})=>{const n=animations[i.name];return n?n({element:t,dTime:o,animation:i}):(console.error("Can not find animation type: "+i.name),{})};export const registerAnimation=(t,o)=>{animations[t]&&console.warn(`Animation "${t}" already exists and will be overridden`),animations[t]=o};