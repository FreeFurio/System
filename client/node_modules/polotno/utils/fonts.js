import*as t from"mobx";import{triggerLoadError as o,getFontLoadTimeout as e}from"./loader.js";let n=t.observable(["Roboto","Amatic SC","Press Start 2P","Marck Script","Rubik Mono One"]),l=t.observable({value:!1});export function isGoogleFontChanged(){return l.value}export function setGoogleFonts(t){"default"!==t?(l.value=!0,n.splice(0,n.length),n.push(...t)):l.value=!1}export function getFontsList(){return n}export const globalFonts=t.observable([]);export function addGlobalFont(t){globalFonts.push(t)}export function removeGlobalFont(t){const o=globalFonts.findIndex(o=>o.fontFamily===t);-1!==o&&globalFonts.splice(o,1)}export function replaceGlobalFonts(t){globalFonts.replace(t)}var r="Some test text;?#D-ПРИВЕТ!1230o9u8i7y6t5r4e3w2q1";let i;function a(t,o="Arial",e="normal",n="normal"){i||(i=document.createElement("canvas"));var l=i.getContext("2d");return l.font=`${e} ${n} 40px '${t}', ${o}`,l.measureText(r).width}export function measureFontDom(t,o="Arial",e="normal",n="normal"){if("undefined"==typeof document||!document.body){return 0}const l=document.createElement("span");l.textContent=r,l.style.cssText=`\n    position:absolute;\n    visibility:hidden;\n    white-space:nowrap;\n    top:-9999px;\n    left:-9999px;\n    font:${e} ${n} 90px '${t}', ${o};\n  `,document.body.appendChild(l);const i=l.getBoundingClientRect().width;return l.remove(),i}const s={Arial:!0};export const isFontLoaded=t=>!!s[t];export async function loadFont(t,n,l){var r;if(s[t]){return}const i=!!(null===(r=document.fonts)||void 0===r?void 0:r.load),c=a("Arial","Arial",n,l);if(i){try{await document.fonts.load(`16px '${t}', ${n} ${l}`);if(c!==a(t,"Arial",n,l)){return void(s[t]=!0)}}catch(d){}}const u=a("Times","Times",n,l),f=a(t,"Arial",n,l),m=Math.min(6e3,e())/60;for(let o=0;o<m;o++){const o=a(t,"Arial",n,l),e=a(t,"Times",n,l);if(o!==f||o!==c||e!==u){return void(s[t]=!0)}await new Promise(t=>setTimeout(t,60))}console.warn(`Timeout for loading font "${t}". Looks like polotno can't load it. Is it a correct font family?`),o(`Timeout for loading font "${t}"`)}const c={};let u="400,400italic,700,700italic";export function setGoogleFontsVariants(t){u=t}export function getGoogleFontsVariants(){return u}export function getGoogleFontsUrl(t){return`https://fonts.googleapis.com/css?family=${t.replace(/ /g,"+")}:${u}`}export function injectGoogleFont(t){if(c[t]){return}const o=getGoogleFontsUrl(t),e=document.createElement("link");e.type="text/css",e.href=o,e.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(e),c[t]=!0}const f={};let m;export function injectCustomFont(t){const o=t.fontFamily;if(f[o]){return}if(!t.url&&!t.styles){return}const e=t.styles||(t.url?[{src:`url("${t.url}")`}]:[]),n=(m||(m=document.getElementById("polotno-font-style"),m||(m=document.createElement("style"),m.id="polotno-font-style",document.head.appendChild(m)),m)).sheet;e.forEach(t=>{n.insertRule(`\n    @font-face{\n      font-family:'${o}';\n      src:${t.src};\n      font-style:${t.fontStyle||"normal"};\n      font-weight:${t.fontWeight||"normal"};\n      font-display:swap;   /* optional but recommended */\n    }`,n.cssRules.length)}),f[t.fontFamily]=!0}