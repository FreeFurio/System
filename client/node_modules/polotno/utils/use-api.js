import{useRef as e,useCallback as t}from"react";import r from"swr/infinite";export const fetcher=e=>fetch(e).then(e=>e.json());export const useInfiniteAPI=({defaultQuery:o="",timeout:i=1e3,getAPI:n,getSize:l=e=>e.total_pages,fetchFunc:a=fetcher})=>{var u;const s=e(o),c=e(),{data:d,error:f,size:v,setSize:h,mutate:m}=r(e=>n({query:s.current,page:e+1}),a,{revalidateAll:!1,revalidateOnFocus:!1}),g=!d&&!f||v>0&&d&&void 0===d[v-1],p=0===(null===(u=null==d?void 0:d[0])||void 0===u?void 0:u.length),y=null==d?void 0:d[d.length-1],z=p||y&&l(y)===v;return{setQuery:t(e=>{s.current=e,clearTimeout(c.current),c.current=setTimeout(()=>{m([])},i)},[i,m]),isLoading:g,loadMore:()=>{z||h(v+1)},isReachingEnd:z,data:null==d?void 0:d.filter(Boolean),items:(null==d?void 0:d.flat())||[],hasMore:!z,reset:m,error:f}};